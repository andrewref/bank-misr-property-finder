<div class="container py-4" *ngIf="!isLoading && property">
  <!-- Back Button -->
  <div class="row mb-4">
    <div class="col-12">
      <button class="btn btn-outline-primary" (click)="goBack()">
        <i class="fas fa-arrow-left me-2"></i>
        Back to Properties
      </button>
    </div>
  </div>

  <!-- Property Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-start flex-wrap">
        <div>
          <h1 class="display-6 fw-bold mb-2">{{ property.title }}</h1>
          <p class="text-muted mb-2">
            <i class="fas fa-map-marker-alt me-2"></i>
            {{ property.address }}
          </p>
          <div class="d-flex align-items-center gap-3 mb-3">
            <span [class]="getStatusBadgeClass(property.status)" class="fs-6">
              {{ getStatusText(property.status) }}
            </span>
            <span class="text-muted">â€¢</span>
            <small class="text-muted">
              Listed {{ property.dateAdded | date:'mediumDate' }}
            </small>
          </div>
        </div>
        <div class="text-end">
          <h2 class="text-primary fw-bold mb-0">
            {{ formatPrice(property.price, property.status) }}
          </h2>
          <div class="d-flex gap-2 mt-2">
            <button class="btn btn-outline-danger btn-sm">
              <i class="far fa-heart"></i>
            </button>
            <button class="btn btn-outline-primary btn-sm">
              <i class="fas fa-share-alt"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="row">
    <!-- Left Column - Images and Description -->
    <div class="col-lg-8">
      <!-- Image Gallery -->
      <div class="card mb-4">
        <div class="position-relative">
          <!-- Main Image -->
          <img 
            [src]="property.images[currentImageIndex]" 
            [alt]="property.title" 
            class="card-img-top property-main-image"
            style="height: 400px; object-fit: cover; cursor: pointer;"
            (click)="toggleFullscreen()">
          
          <!-- Image Navigation -->
          <div class="position-absolute top-50 start-0 translate-middle-y ms-3" 
               *ngIf="property.images.length > 1">
            <button class="btn btn-light rounded-circle" (click)="previousImage()">
              <i class="fas fa-chevron-left"></i>
            </button>
          </div>
          <div class="position-absolute top-50 end-0 translate-middle-y me-3" 
               *ngIf="property.images.length > 1">
            <button class="btn btn-light rounded-circle" (click)="nextImage()">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
          
          <!-- Fullscreen Button -->
          <div class="position-absolute top-0 end-0 m-3">
            <button class="btn btn-dark btn-sm" (click)="toggleFullscreen()">
              <i class="fas fa-expand"></i>
            </button>
          </div>
          
          <!-- Image Counter -->
          <div class="position-absolute bottom-0 end-0 m-3">
            <span class="badge bg-dark">
              {{ currentImageIndex + 1 }} / {{ property.images.length }}
            </span>
          </div>
        </div>
        
        <!-- Thumbnail Images -->
        <div class="card-body" *ngIf="property.images.length > 1">
          <div class="row g-2">
            <div 
              *ngFor="let image of property.images; let i = index" 
              class="col-3 col-md-2">
              <img 
                [src]="image" 
                [alt]="'Image ' + (i + 1)" 
                class="img-thumbnail property-thumbnail"
                [class.active]="i === currentImageIndex"
                style="height: 80px; object-fit: cover; cursor: pointer;"
                (click)="selectImage(i)">
            </div>
          </div>
        </div>
      </div>

      <!-- Property Description -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">
            <i class="fas fa-info-circle me-2"></i>
            Description
          </h5>
          <p class="card-text">{{ property.description }}</p>
        </div>
      </div>

      <!-- Features -->
      <div class="card mb-4" *ngIf="property.features.length > 0">
        <div class="card-body">
          <h5 class="card-title">
            <i class="fas fa-star me-2"></i>
            Features & Amenities
          </h5>
          <div class="row">
            <div 
              *ngFor="let feature of property.features" 
              class="col-md-6 col-lg-4 mb-2">
              <div class="d-flex align-items-center">
                <i class="fas fa-check text-success me-2"></i>
                <span>{{ feature }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column - Details and Contact -->
    <div class="col-lg-4">
      <!-- Property Overview -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">
            <i class="fas fa-home me-2"></i>
            Property Overview
          </h5>
          <div class="row g-3">
            <div class="col-6" *ngIf="property.bedrooms > 0">
              <div class="text-center p-3 bg-light rounded">
                <i class="fas fa-bed text-primary fs-4 mb-2"></i>
                <div class="fw-bold">{{ property.bedrooms }}</div>
                <small class="text-muted">Bedrooms</small>
              </div>
            </div>
            <div class="col-6">
              <div class="text-center p-3 bg-light rounded">
                <i class="fas fa-bath text-primary fs-4 mb-2"></i>
                <div class="fw-bold">{{ property.bathrooms }}</div>
                <small class="text-muted">Bathrooms</small>
              </div>
            </div>
            <div class="col-6">
              <div class="text-center p-3 bg-light rounded">
                <i class="fas fa-ruler-combined text-primary fs-4 mb-2"></i>
                <div class="fw-bold">{{ property.area | number }}</div>
                <small class="text-muted">Sq Ft</small>
              </div>
            </div>
            <div class="col-6" *ngIf="property.parking && property.parking > 0">
              <div class="text-center p-3 bg-light rounded">
                <i class="fas fa-car text-primary fs-4 mb-2"></i>
                <div class="fw-bold">{{ property.parking }}</div>
                <small class="text-muted">Parking</small>
              </div>
            </div>
          </div>
          
          <!-- Additional Details -->
          <hr>
          <div class="row">
            <div class="col-12 mb-2">
              <strong>Property Type:</strong> 
              <span class="text-capitalize">{{ property.type }}</span>
            </div>
            <div class="col-12 mb-2" *ngIf="property.yearBuilt">
              <strong>Year Built:</strong> {{ property.yearBuilt }}
            </div>
            <div class="col-12 mb-2">
              <strong>Furnished:</strong> 
              <span class="badge" [class]="property.furnished ? 'bg-success' : 'bg-secondary'">
                {{ property.furnished ? 'Yes' : 'No' }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Contact Agent -->
      <div class="card" *ngIf="property.agent">
        <div class="card-body">
          <h5 class="card-title">
            <i class="fas fa-user-tie me-2"></i>
            Contact Agent
          </h5>
          <div class="text-center mb-3">
            <div class="mb-3">
              <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center" 
                   style="width: 60px; height: 60px;">
                <i class="fas fa-user fs-4"></i>
              </div>
            </div>
            <h6 class="fw-bold mb-1">{{ property.agent.name }}</h6>
            <small class="text-muted" *ngIf="property.agent.company">
              {{ property.agent.company }}
            </small>
          </div>
          
          <div class="d-grid gap-2">
            <button class="btn btn-primary" (click)="callAgent()">
              <i class="fas fa-phone me-2"></i>
              {{ property.agent.phone }}
            </button>
            <button class="btn btn-outline-primary" (click)="contactAgent()">
              <i class="fas fa-envelope me-2"></i>
              Send Email
            </button>
          </div>
          
          <hr>
          <div class="text-center">
            <small class="text-muted">Response time: Usually within 2 hours</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div *ngIf="isLoading" class="container py-5">
  <div class="text-center">
    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
      <span class="visually-hidden">Loading property details...</span>
    </div>
    <p class="mt-3 text-muted">Loading property information...</p>
  </div>
</div>

<!-- Fullscreen Image Modal -->
<div *ngIf="isFullscreen && property" class="fullscreen-modal" (click)="toggleFullscreen()">
  <div class="fullscreen-content">
    <img 
      [src]="property.images[currentImageIndex]" 
      [alt]="property.title" 
      class="fullscreen-image">
    <button class="btn btn-light rounded-circle fullscreen-close" (click)="toggleFullscreen()">
      <i class="fas fa-times"></i>
    </button>
  </div>
</div>
